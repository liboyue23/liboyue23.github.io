title: 分布式技术架构
date: 2015-06-26 17:51:25
categories: 技术
tags: [java,分布式]
toc: false
---
#zookeeper
对于zookeeper部署的一些重要提示：
1. 使用监控程序来运行zookeeper是很重要的，因为zookeeper是快速失败的，遇到任何错误情况将会退出
2. 简历cron来压缩zookeeper的数据和事务日志是很重要的。zookeeper守护进程自己本身并不会这么做，如果不设置cron，zookeeper很快就会耗尽磁盘空间

#zookeeper功能介绍
1. 加强集群稳定性
2. 加强集群持续性
3. 保证集群有序性
4. 保证集群高效
5. 数据结构和分等级的空间命名（znode）

<!--more-->

#zookeeper原理架构
1. zookeeper的核心是原子广播，这个机制保证了各个Server之间的同步。实现这个机制的协议叫做Zab协议。Zab协议有两种模式，它们分别是恢复模式（选主）和广播模式（同步）
2. 当服务启动或者在领导者崩溃后，Zab就进入了回复模式，当领导者被选举出来，且大多数Server完成了和leader的状态同步以后，恢复模式就结束了。状态同步保证了leader和Server具有相同的系统状态。
3. 每个Server工作过程中的三种状态：LOOKING（正在搜寻leader）；LEADING（为leader标记）；FOLLOWING：leader（已经选举出来。当前与之同步）

#zookeeper选举机制
Fastleader选举算法：
当leader崩溃或者失去大多数的follower时，这时候zookeeper进入回复模式，回复模式需要重新选举出一个新的leader，让所有的Server都恢复到一个正确的状态。

#zookeeper应用场景
1. 统一命名服务（Name Service）
2. 配置管理
3. 集群管理
4. 共享锁
5. 队列管理
