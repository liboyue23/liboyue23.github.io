var Instagram=function(){var e=[],t=function(e){for(var t in e)for(var i=0,n=e[t].srclist.length;n>i;i++){var o=e[t].bigSrclist[i],a=new Image;a.src=o}},i=function(e){for(var i in e){for(var n="",o=0,a=e[i].srclist.length;a>o;o++)n+='<li>								<div class="img-box">									<a class="img-bg" rel="example_group" href="'+e[i].bigSrclist[o]+'" title="'+e[i].text[o]+'"></a>									<img lazy-src="'+e[i].srclist[o]+'" alt="">								</div>							</li>';$('<section class="archives album"><h1 class="year">'+e[i].year+"<em>"+e[i].month+'月</em></h1>				<ul class="img-box-ul">'+n+"</ul>				</section>").appendTo($(".instagram"))}$(".instagram").lazyload(),r(),setTimeout(function(){t(e)},3e3),$("a[rel=example_group]").fancybox()},n=function(e){if(e.indexOf("outbound-distilleryimage")>=0){var t=e.match(/outbound-distilleryimage([\s\S]*?)\//)[1],i=e.split("/");return"http://distilleryimage"+t+".ak.instagram.com/"+i[i.length-1]}var n="http://photos-g.ak.instagram.com/hphotos-ak-xpf1/",i=e.split("/");return n+i[i.length-1]},o=function(e){for(var t={},o=0,a=e.length;a>o;o++){var r=new Date(1e3*e[o].created_time),s=r.getFullYear(),l=r.getMonth()+1,c=n(e[o].images.low_resolution.url),d=n(e[o].images.standard_resolution.url),p=e[o].caption.text,h=s+"-"+l;t[h]?(t[h].srclist.push(c),t[h].bigSrclist.push(d),t[h].text.push(p)):t[h]={year:s,month:l,srclist:[d],bigSrclist:[d],text:[p]}}i(t)},a=function(t){$(".open-ins").html("图片来自instagram，正在加载中…"),$.ajax({url:t,type:"GET",dataType:"jsonp",success:function(t){if(200==t.meta.code){e=e.concat(t.data);var i=t.pagination.next_url;i?a(i):($(".open-ins").html("图片来自instagram，点此访问"),o(e))}else alert("access_token timeout!")}})},r=function(){if($(document).width()<=600)$(".img-box").css({width:"auto",height:"auto"});else{var e=$(".img-box-ul").width(),t=Math.max(.26*e,157);$(".img-box").width(t).height(t)}},s=function(){$(window).resize(function(){r()})};return{init:function(){var e=$(".instagram").attr("data-client-id");return e?(a("https://api.instagram.com/v1/users/438522285/media/recent/?client_id="+e+"&count=100"),s(),void 0):(alert("Didn't set your instagram client_id.\nPlease see the info on the console of your brower."),console.log("Please open 'http://instagram.com/developer/clients/manage/' to get your client-id."),void 0)}}}();$(function(){Instagram.init()});